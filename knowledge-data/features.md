# AI-Agent位置情報共有アプリ - 機能仕様書

## アプリ概要

AI-agentが自動的にユーザー同士を繋げ、位置情報と暇ステータスに基づいて飲み会や遊びの計画を提案・立案する次世代の位置情報共有アプリ。

相手別に位置情報の共有レベルを細かく制御でき、AI-agentが自動的に周囲の暇なユーザーを発見し、予定のない人同士を繋げて遊びプランを提案。予約リンクの表示まで自動化し、シームレスな遊び体験を提供する。

## 主要機能概要

### コアコンセプト
- **AI-agentによる自動マッチング・提案システム**
- **詳細な位置情報権限管理（相手別・グループ別）**
- **リアルタイム暇ステータス共有**
- **グループベースのコミュニケーション**
- **お店側アカウント統合**
- **予約リンク表示までの自動化**

## 詳細機能仕様

### 1. AI-Agent自動システム

#### 1.1 AI-Agent思考プロセス
- **定期的な暇ステータス監視**
  - ユーザーが「暇」ステータス設定時の自動監視開始
  - 周囲の位置情報範囲内ユーザーの暇ステータス確認
  - 既存予定の有無を自動検証
  
- **自動マッチング判定**
  - 距離、時間、興味の一致度を総合評価
  - 過去の交流履歴・相性データを考慮
  - グループサイズの最適化（2-6人推奨）

#### 1.2 AI提案システム
- **既存予定がある場合**
  - 予定に参加可能な追加メンバーの自動提案
  - 予定内容に合わせた店舗・場所の推薦
  - 時間調整・場所変更の代替案提示
  
- **新規プラン立案**
  - 参加者全員の嗜好を分析した遊びプラン自動生成
  - 予算・時間・移動距離を考慮した最適化
  - リアルタイム空席状況を反映した店舗推薦

#### 1.3 自動提案・調整機能
- **プラン提案の自動送信**
  - マッチしたユーザーグループへの一斉提案
  - 個別事情を考慮したカスタマイズ提案
  - 代替案の自動準備・提示
  
- **スケジュール自動調整**
  - 参加者の空き時間の自動照合
  - 最適な開始時間・終了時間の提案
  - 移動時間を考慮した集合時間の計算

### 2. 位置情報権限管理システム

#### 2.1 相手別位置情報共有レベル
- **レベル1: 詳細位置（恋人・家族向け）**
  - リアルタイム正確位置（誤差10m以内）
  - 移動経路・移動速度の表示
  - 滞在時間・頻繁に訪れる場所の共有
  - 家・職場などの重要地点の明示
  
- **レベル2: 大雑把位置（友人向け）**
  - 大まかなエリア位置（500m-1km範囲）
  - 「家にいる」「外出中」「職場」のステータス表示
  - 最終更新時刻の表示（30分〜2時間前など）
  - 近くにいるかどうかの確認のみ
  
- **レベル3: 非表示（見せたくない相手）**
  - 位置情報完全非表示
  - オンライン状況のみ表示
  - 暇ステータスは表示（位置は非表示）
  
- **レベル4: ブロック**
  - 全情報非表示
  - 相手から発見されない設定

#### 2.2 グループ別権限設定
- **グループ作成機能**
  - 「親しい友人」「大学の友達」「職場」「趣味仲間」等
  - グループ単位での一括権限設定
  - グループ内メンバーの権限継承機能
  
- **状況別権限設定**
  - 平日・休日での権限切り替え
  - 時間帯別権限設定（深夜は非表示など）
  - 特定期間の一時的権限変更

### 3. ユーザー管理機能

#### 3.1 認証・プロフィール
- **アカウント作成**
  - メールアドレス、電話番号、SNS連携
  - プロフィール設定（名前、アイコン、自己紹介）
  - 興味・趣味カテゴリーの詳細設定
  
- **QRコード招待システム**
  - 個人QRコード生成
  - QRコード読み取りでの友達追加
  - 招待リンク生成・共有機能
  - 一時的な招待コード（24時間限定等）

#### 3.2 暇ステータス管理
- **リアルタイムステータス**
  - 「今すぐ暇」「2時間後から暇」「明日暇」
  - 暇になる時間・暇でいられる時間の設定
  - やりたいこと（飲み、カフェ、映画、買い物等）の詳細設定
  
- **自動ステータス更新**
  - カレンダー連携による自動ステータス設定
  - 位置情報による「家にいる」「移動中」の自動判定
  - 学習機能による行動パターン予測

### 4. お店側アカウント機能

#### 4.1 店舗アカウント管理
- **店舗登録**
  - 店舗情報（名前、住所、営業時間、ジャンル）
  - メニュー・価格帯・席数の登録
  - 写真・店舗紹介文の設定
  
- **リアルタイム状況更新**
  - 現在の空席状況・混雑度の手動更新
  - 満席・空席の切り替え機能
  - 待ち時間の目安表示

#### 4.2 AI連携機能
- **自動推薦対象**
  - AI-agentが店舗を自動推薦候補に追加
  - ユーザーの嗜好・予算に基づく優先表示
  - 立地・アクセスを考慮したマッチング
  
- **利用状況フィードバック**
  - ユーザーからの評価・レビュー収集
  - 混雑予測データの学習・改善
  - 推薦精度向上のためのデータ活用

### 5. グループチャット・コミュニケーション機能

#### 5.1 グループチャットシステム
- **AI提案ベースグループ作成**
  - AI-agentが提案したメンバーでの自動グループ作成
  - プラン毎に独立したチャットルーム
  - 参加・辞退の簡単切り替え機能
  
- **グループ内コミュニケーション**
  - リアルタイムメッセージング
  - 画像・位置情報の共有
  - 投票機能（店選び、時間決めなど）
  - スケジュール調整機能

#### 5.2 AI-Agent支援チャット
- **自動返信・調整**
  - ユーザーの代わりにAI-agentが初期対応
  - 日程・場所調整の自動化
  - 不在時の自動応答設定
  
- **プラン調整支援**
  - 代替案の自動提示
  - 予算・時間制約の考慮
  - 全員の合意形成サポート

### 6. 地図・位置表示機能

#### 6.1 ホーム画面（地図）
- **メイン地図表示**
  - 自分の現在位置を中心とした地図
  - 権限レベルに応じた友達位置の表示
  - 暇ステータスのリアルタイム反映
  
- **フィルター・表示設定**
  - 権限レベル別表示切り替え
  - 暇ステータス別フィルター
  - 距離範囲の調整（500m〜10km）
  - やりたいこと別の色分け表示

#### 6.2 インタラクティブ機能
- **ワンタップ操作**
  - 自分のステータス変更（浮きボタン）
  - 近くの暇な友達への即座アプローチ
  - AI提案の受諾・拒否
  
- **店舗情報統合**
  - 地図上の店舗情報表示
  - リアルタイム空席状況の反映
  - 予約リンクへの直接アクセス

### 7. 予約・外部連携機能

#### 7.1 予約リンク表示機能
- **自動予約リンク生成**
  - 提案された店舗の予約サイトへの直接リンク
  - グルメサイト（ぐるなび、食べログ、ホットペッパー）連携
  - 映画館・レジャー施設の予約サイト連携
  
- **予約情報の統合表示**
  - 空席状況・予約可能時間の表示
  - 予約手順の簡潔な説明
  - グループメンバーでの予約分担機能

#### 7.2 外部サービス連携
- **カレンダー連携**
  - Google Calendar、Apple Calendarとの同期
  - 予定の自動インポート・エクスポート
  - スケジュール競合の自動検出
  
- **決済・割り勘機能**
  - 割り勘計算機能
  - 外部決済アプリとの連携準備
  - 予算管理・支払履歴機能

## 画面構成・UI仕様

### 1. ホーム画面（地図画面）
- **地図エリア（画面の70%）**
  - 現在地中心の地図表示
  - 友達位置のピン表示（権限レベル別）
  - 暇ステータスの色分け表示
  - 店舗情報のアイコン表示
  
- **下部UI（画面の30%）**
  - 自分のステータス設定（大きなボタン）
  - 近くの暇な友達リスト（横スクロール）
  - AI提案通知エリア
  - フィルター・設定アクセス

### 2. AI提案・グループ画面
- **提案カード表示**
  - AI生成プランの詳細表示
  - 参加予定メンバーの一覧
  - 推薦店舗・場所の情報
  
- **グループチャット統合**
  - 提案に対するグループディスカッション
  - 参加・不参加の表明
  - 代替案の相談・投票

### 3. プロフィール・設定画面
- **位置情報権限管理**
  - 友達リストと権限レベル設定
  - グループ作成・管理
  - デフォルト権限設定
  
- **AI設定・学習データ**
  - 嗜好・興味の詳細設定
  - AI提案の精度調整
  - 学習データの確認・修正

### 4. QRコード・招待画面
- **QRコード表示・読み取り**
  - 個人QRコードの生成・表示
  - カメラでのQRコード読み取り
  - 招待リンクの生成・共有
  
- **友達管理**
  - 友達申請の送信・受信
  - 友達リストの管理
  - ブロック・削除機能

## 主要ユースケース

### ケース1: AI自動提案による飲み会
1. ユーザーA「今夜暇」ステータス設定
2. AI-agent周囲の暇ユーザーB、Cを発見
3. 3人の嗜好を分析し、居酒屋を自動提案
4. グループチャット自動作成、AI提案を共有
5. メンバー合意後、予約リンクを表示
6. 各自で予約完了、当日集合

### ケース2: 段階的位置情報共有
1. 恋人には詳細位置を常時共有
2. 友人には「渋谷エリアにいる」程度の共有
3. 職場の人には「オンライン」のみ表示
4. 元恋人はブロック設定で完全非表示

### ケース3: 店舗アカウント連携
1. カフェオーナーが空席状況を「空いてます」に更新
2. AI-agentが近くの暇なユーザーにカフェを提案
3. ユーザーグループがカフェ利用を決定
4. 予約リンクから直接予約完了

### ケース4: QRコード友達追加
1. 新しく知り合った人とQRコード交換
2. デフォルト権限レベル2（大雑把位置）で追加
3. 親しくなったらレベル1（詳細位置）に変更
4. 権限レベルに応じた情報共有開始

## 技術的考慮事項

### AI-Agent アーキテクチャ
- **機械学習モデル**
  - ユーザー嗜好学習アルゴリズム
  - 位置・時間・活動パターンの分析
  - グループダイナミクスの最適化
  
- **リアルタイム処理**
  - ストリーミングデータ処理
  - 低遅延の位置情報更新
  - プッシュ通知の最適化

### プライバシー・セキュリティ
- **位置情報暗号化**
  - エンドツーエンド暗号化
  - 権限レベル別の情報マスキング
  - 位置データの適切な保存期間設定
  
- **AI倫理**
  - バイアス防止の仕組み
  - 透明性のあるAI意思決定
  - ユーザー制御可能なAI設定

### スケーラビリティ
- **リアルタイムデータ処理**
  - Firebase Realtime Database活用
  - 地理的分散処理
  - 負荷分散の最適化
  
- **AI処理の効率化**
  - エッジコンピューティング活用
  - キャッシュ戦略の最適化
  - バッチ処理とリアルタイム処理の使い分け

### データベース操作・Firestoreサービス

#### データ保存・取得のための統一helper関数
**ファイル:** `collect-friends-app/utils/firestoreService.ts`

このアプリではFirestoreでのデータ操作を統一されたインターフェースで行うため、専用のhelper関数群を提供しています。**データを保存・取得する際は、必ずこのfirestoreService.tsのhelper関数を使用してください。**

- **主要関数**
  - `setDocument(path, data, merge)` - ドキュメントの作成・更新
  - `getDocument(path)` - ドキュメントの取得
  - `updateDocument(path, data)` - ドキュメントの部分更新
  - `deleteDocument(path)` - ドキュメントの削除
  - `getCollection(collectionPath)` - コレクション全体の取得
  - `getCollectionWithQuery(collectionPath, constraints)` - クエリ付きコレクション取得
  - `addDocument(collectionPath, data)` - 自動IDでドキュメント追加

- **使用例**
  ```typescript
  import { setDocument, getDocument } from '../utils/firestoreService';
  
  // ユーザーデータを保存
  await setDocument('/users/user123', {
    name: '田中太郎',
    email: 'tanaka@example.com',
    age: 30
  });
  
  // ユーザーデータを取得
  const user = await getDocument('/users/user123');
  ```

- **Helper関数の利点**
  - 統一されたAPI設計による保守性の向上
  - 自動タイムスタンプ追加（createdAt, updatedAt）
  - 包括的なエラーハンドリングとログ出力
  - 直感的なパス指定（例："/users/uid"）
  - TypeScript型安全性の保証
  - 一貫したデータ構造の維持

- **データ保存ガイドライン**
  - 新しいデータ保存が必要な場合は、firestoreService.tsの関数を使用
  - 直接FirestoreのSDKを呼び出さず、必ずhelper関数を経由
  - データ構造の設計時は自動追加されるタイムスタンプフィールドを考慮
  - エラーハンドリングはhelper関数に任せ、呼び出し元では適切な UI フィードバックに集中
