# ä½ç½®æƒ…å ±ãƒ™ãƒ¼ã‚¹ ãŠã™ã™ã‚ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£æ¨è–¦API

LangGraphã¨LLMã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ãŸã€ä½ç½®æƒ…å ±ãƒ™ãƒ¼ã‚¹ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£æ¨è–¦ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

## ğŸš€ æ©Ÿèƒ½

- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¨è–¦**: Server-Sent Events (SSE)ã«ã‚ˆã‚‹ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¿œç­”
- **é§…å‘¨è¾ºæ¤œç´¢**: Google Places APIã‚’ä½¿ç”¨ã—ãŸé§…å‘¨è¾ºã®æ–½è¨­æ¤œç´¢
- **LLMã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ**: Gemini APIã‚’ä½¿ç”¨ã—ãŸã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆãªæ¨è–¦
- **ä¸¦åˆ—å‡¦ç†**: è¤‡æ•°é§…ã®åŒæ™‚èª¿æŸ»ã«ã‚ˆã‚‹é«˜é€ŸåŒ–
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½**: Redisã‚’ä½¿ç”¨ã—ãŸåŠ¹ç‡çš„ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥
- **ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°**: æ§‹é€ åŒ–ãƒ­ã‚°ã¨ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FastAPI       â”‚    â”‚   LangGraph     â”‚    â”‚   Google APIs   â”‚
â”‚   (SSE Stream)  â”‚â”€â”€â”€â–¶â”‚   (Research)    â”‚â”€â”€â”€â–¶â”‚   (Places/LLM)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚
         â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Redis       â”‚    â”‚   Coordinator   â”‚
â”‚   (Cache)       â”‚â—€â”€â”€â”€â”‚   (Parallel)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ› ï¸ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å‰ææ¡ä»¶

- Docker & Docker Compose
- Google API ã‚­ãƒ¼ (Places API)
- Google Gemini API ã‚­ãƒ¼

### ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

```bash
cp .env.example .env
# .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¦APIã‚­ãƒ¼ã‚’è¨­å®š
```

å¿…è¦ãªç’°å¢ƒå¤‰æ•°:
```env
GOOGLE_API_KEY=your_google_api_key
GEMINI_API_KEY=your_gemini_api_key
```

### é–‹ç™ºç’°å¢ƒã§ã®èµ·å‹•

```bash
# Dockerç’°å¢ƒã‚’æ§‹ç¯‰ãƒ»èµ·å‹•
make build
make run

# ãƒ­ã‚°ã®ç¢ºèª
make logs

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
make health
```

### é–‹ç™ºãƒ„ãƒ¼ãƒ«ä»˜ãã§èµ·å‹•

```bash
# Redis Commanderã‚‚å«ã‚ã¦èµ·å‹•
make dev
```

ã‚¢ã‚¯ã‚»ã‚¹å…ˆ:
- API: http://localhost:8080
- API ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: http://localhost:8080/docs
- Redis Commander: http://localhost:8081

## ğŸ“¡ APIä½¿ç”¨æ–¹æ³•

### ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°æ¨è–¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

```bash
curl -X POST http://localhost:8080/recommendations/stream \
  -H "Content-Type: application/json" \
  -H "X-API-Key: your_api_key" \
  -d '{
    "user_location": {
      "latitude": 35.676225,
      "longitude": 139.650348
    },
    "group_info": {
      "member_count": 2,
      "member_moods": ["ãŠèŒ¶ãƒ»ã‚«ãƒ•ã‚§", "æ•£æ­©ãƒ»ã¶ã‚‰ã¶ã‚‰"],
      "budget_range": "Â¥1500-4500"
    },
    "context": {
      "current_time": "2025-06-29T14:30:00+09:00"
    }
  }'
```

### ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹

```
event: status_update
data: {"message": "ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‹ã‚‰é§…å€™è£œã‚’æ¤œç´¢ä¸­...", "step": "STATION_SEARCH"}

event: research_update  
data: {"message": "æ–°å®¿é§…ã®èª¿æŸ»ã‚’é–‹å§‹...", "station": "æ–°å®¿", "status": "IN_PROGRESS"}

event: final_report
data: {
  "status": "COMPLETE",
  "recommendations": [
    {
      "rank": 1,
      "station_info": {
        "name": "æ–°å®¿é§…",
        "distance_from_user_m": 1200,
        "travel_time_min": 15
      },
      "activities": [...],
      "overall_score": 8.7,
      "recommendation_reason": "æ–°å®¿é§…å‘¨è¾ºã¯å¤šæ§˜ãªã‚«ãƒ•ã‚§ã¨æ•£æ­©ã‚¹ãƒãƒƒãƒˆãŒå……å®Ÿã—ã¦ã„ã¾ã™ã€‚"
    }
  ]
}
```

## ğŸ§ª ãƒ†ã‚¹ãƒˆ

```bash
# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
make test

# ãƒªãƒ³ãƒ†ã‚£ãƒ³ã‚°
make lint

# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
make format

# å‹ãƒã‚§ãƒƒã‚¯
make type-check
```

## ğŸ“Š ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

### ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯

```bash
# åŸºæœ¬ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl http://localhost:8080/health

# è©³ç´°ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl http://localhost:8080/health/detailed

# ãƒ¡ãƒˆãƒªã‚¯ã‚¹
curl http://localhost:8080/metrics
```

### ãƒ­ã‚°ç¢ºèª

```bash
# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚°
make logs

# Redisãƒ­ã‚°
make logs-redis

# å…¨ã‚µãƒ¼ãƒ“ã‚¹ãƒ­ã‚°
make logs-all
```

## ğŸš€ æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤

### æœ¬ç•ªç’°å¢ƒã§ã®èµ·å‹•

```bash
# ãƒ‡ãƒ—ãƒ­ã‚¤å‰ãƒã‚§ãƒƒã‚¯
make deploy-check

# æœ¬ç•ªç’°å¢ƒãƒ“ãƒ«ãƒ‰ãƒ»èµ·å‹•
make prod-build
make prod-run
```

### æœ¬ç•ªç’°å¢ƒè¨­å®š

```bash
# æœ¬ç•ªç”¨docker-compose
docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d
```

## ğŸ”§ é–‹ç™ºã‚¬ã‚¤ãƒ‰

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
python/
â”œâ”€â”€ app/                    # ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”œâ”€â”€ api/               # API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ core/              # è¨­å®šãƒ»å…±é€šæ©Ÿèƒ½
â”‚   â”œâ”€â”€ schemas/           # Pydantic ã‚¹ã‚­ãƒ¼ãƒ
â”‚   â”œâ”€â”€ services/          # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â””â”€â”€ utils/             # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”œâ”€â”€ research/              # LangGraph ç ”ç©¶ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ graph.py           # LangGraph å®šç¾©
â”‚   â”œâ”€â”€ nodes.py           # å„ãƒãƒ¼ãƒ‰å®Ÿè£…
â”‚   â””â”€â”€ state.py           # çŠ¶æ…‹ç®¡ç†
â”œâ”€â”€ tests/                 # ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
â””â”€â”€ resources/             # ãƒªã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«
```

### æ–°æ©Ÿèƒ½ã®è¿½åŠ 

1. ã‚¹ã‚­ãƒ¼ãƒå®šç¾© (`app/schemas/`)
2. ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£… (`app/services/`)
3. API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ (`app/api/`)
4. ãƒ†ã‚¹ãƒˆä½œæˆ (`tests/`)

### LangGraphã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®æ‹¡å¼µ

1. æ–°ãƒãƒ¼ãƒ‰è¿½åŠ  (`research/nodes.py`)
2. çŠ¶æ…‹æ›´æ–° (`research/state.py`)
3. ã‚°ãƒ©ãƒ•æ§‹é€ æ›´æ–° (`research/graph.py`)

## ğŸ”¨ åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰

```bash
make help                  # ãƒ˜ãƒ«ãƒ—è¡¨ç¤º
make build                 # Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰
make run                   # é–‹ç™ºç’°å¢ƒèµ·å‹•
make stop                  # ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢
make clean                 # ç’°å¢ƒã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
make test                  # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
make logs                  # ãƒ­ã‚°è¡¨ç¤º
make shell                 # ã‚³ãƒ³ãƒ†ãƒŠã‚·ã‚§ãƒ«
make redis-cli             # Redis CLIæ¥ç¶š
make health                # ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
make backup-redis          # Redisãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
```

## ğŸ“ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

1. **APIã‚­ãƒ¼ã‚¨ãƒ©ãƒ¼**
   ```bash
   # .envãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª
   cat .env
   ```

2. **Redisæ¥ç¶šã‚¨ãƒ©ãƒ¼**
   ```bash
   # Redisã‚³ãƒ³ãƒ†ãƒŠã®çŠ¶æ…‹ç¢ºèª
   make status
   docker-compose logs redis
   ```

3. **ãƒãƒ¼ãƒˆç«¶åˆ**
   ```bash
   # ãƒãƒ¼ãƒˆä½¿ç”¨çŠ¶æ³ç¢ºèª
   lsof -i :8080
   lsof -i :6379
   ```

### ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«èª¿æ•´

```env
# é–‹ç™ºæ™‚
LOG_LEVEL=DEBUG

# æœ¬ç•ªæ™‚
LOG_LEVEL=WARNING
```

## ğŸ“„ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- APIä»•æ§˜æ›¸: http://localhost:8080/docs
- ReDoc: http://localhost:8080/redoc
- è©³ç´°ä»•æ§˜: [FastAPIä»•æ§˜æ›¸.md](./FastAPIä»•æ§˜æ›¸.md)
- å®Ÿè£…æ‰‹é †: [å®Ÿè£…æ‰‹é †æ›¸.md](./å®Ÿè£…æ‰‹é †æ›¸.md)